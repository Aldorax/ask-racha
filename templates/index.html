<!DOCTYPE html>
<html>
  <head>
    <title>Storacha RAG Chatbot</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
      }
      .section {
        margin: 20px 0;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      textarea,
      input {
        width: 100%;
        padding: 10px;
        margin: 5px 0;
      }
      button {
        background: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      button:hover {
        background: #0056b3;
      }
      .chat {
        max-height: 400px;
        overflow-y: auto;
        border: 1px solid #eee;
        padding: 10px;
      }
      .message {
        margin: 10px 0;
        padding: 10px;
        border-radius: 5px;
      }
      .user {
        background: #e3f2fd;
      }
      .bot {
        background: #f3e5f5;
      }
      .status {
        margin: 10px 0;
        padding: 10px;
        border-radius: 5px;
      }
      .success {
        background: #d4edda;
        color: #155724;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
      }
    </style>
  </head>
  <body>
    <h1>ðŸ“š Storacha RAG Chatbot</h1>

    <div class="section">
      <h3>ðŸ”§ Load Documents</h3>
      <textarea id="urls" rows="5" placeholder="Enter URLs (one per line)">
https://docs.storacha.network/
https://storacha.network/
https://docs.storacha.network/quickstart/</textarea
      >
      <button onclick="loadDocuments()">Load Documents</button>
      <div id="loadStatus"></div>
    </div>

    <div class="section">
      <h3>ðŸ’¬ Chat</h3>
      <div id="chat" class="chat"></div>
      <input
        type="text"
        id="question"
        placeholder="Ask a question about Storacha..."
        onkeypress="handleEnter(event)"
      />
      <button onclick="askQuestion()">Ask</button>
    </div>

    <script>
      function loadDocuments() {
        const urls = document
          .getElementById("urls")
          .value.split("\n")
          .filter((url) => url.trim());
        const status = document.getElementById("loadStatus");

        status.innerHTML = '<div class="status">Loading documents...</div>';

        fetch("/load_documents", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ urls: urls }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              status.innerHTML = `<div class="status success">${data.message}</div>`;
            } else {
              status.innerHTML = `<div class="status error">Error: ${data.message}</div>`;
            }
          })
          .catch((error) => {
            status.innerHTML = `<div class="status error">Error: ${error}</div>`;
          });
      }

      function askQuestion() {
        const question = document.getElementById("question").value.trim();
        if (!question) return;

        const chat = document.getElementById("chat");
        chat.innerHTML += `<div class="message user"><strong>You:</strong> ${question}</div>`;

        document.getElementById("question").value = "";
        chat.innerHTML +=
          '<div class="message bot"><strong>Bot:</strong> Thinking...</div>';
        chat.scrollTop = chat.scrollHeight;

        fetch("/query", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ question: question }),
        })
          .then((response) => response.json())
          .then((data) => {
            const messages = chat.getElementsByClassName("message");
            const lastMessage = messages[messages.length - 1];

            if (data.success) {
              lastMessage.innerHTML = `<strong>Bot:</strong> ${data.answer}`;
            } else {
              lastMessage.innerHTML = `<strong>Bot:</strong> Error: ${data.message}`;
            }
            chat.scrollTop = chat.scrollHeight;
          })
          .catch((error) => {
            const messages = chat.getElementsByClassName("message");
            const lastMessage = messages[messages.length - 1];
            lastMessage.innerHTML = `<strong>Bot:</strong> Error: ${error}`;
          });
      }

      function handleEnter(event) {
        if (event.key === "Enter") {
          askQuestion();
        }
      }
    </script>
  </body>
</html>
